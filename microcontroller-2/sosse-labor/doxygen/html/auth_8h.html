<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>SOSSE: auth.h File Reference</title>
<link href="sos.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.4.7 -->
<div class="tabs">
  <ul>
    <li><a href="index.html"><span>Main&nbsp;Page</span></a></li>
    <li><a href="annotated.html"><span>Data&nbsp;Structures</span></a></li>
    <li id="current"><a href="files.html"><span>Files</span></a></li>
    <li><a href="pages.html"><span>Related&nbsp;Pages</span></a></li>
  </ul></div>
<div class="tabs">
  <ul>
    <li><a href="files.html"><span>File&nbsp;List</span></a></li>
    <li><a href="globals.html"><span>Globals</span></a></li>
  </ul></div>
<h1>auth.h File Reference</h1>Authentication declarations. <a href="#_details">More...</a>
<p>
<code>#include &lt;<a class="el" href="types_8h-source.html">types.h</a>&gt;</code><br>

<p>
<a href="auth_8h-source.html">Go to the source code of this file.</a><table border="0" cellpadding="0" cellspacing="0">
<tr><td></td></tr>
<tr><td colspan="2"><br><h2>Defines</h2></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="auth_8h.html#eaa1f3d53530fd751bea7f48a6ee7cc6">AUTH_FLAG_PIN</a>&nbsp;&nbsp;&nbsp;0x01</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Flag for authstate signalling a successful PIN verification.  <a href="#eaa1f3d53530fd751bea7f48a6ee7cc6"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="auth_8h.html#1defcbb7e6fa25bac6924c00f4614d35">AUTH_FLAG_KEY</a>&nbsp;&nbsp;&nbsp;0x02</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Flag for authstate signalling a successful external authentication or key verification.  <a href="#1defcbb7e6fa25bac6924c00f4614d35"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="auth_8h.html#06f918f6ed2d5e24c682eb3ae194bca4">AUTH_AC_ALW</a>&nbsp;&nbsp;&nbsp;0x0</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Access Condition: Always.  <a href="#06f918f6ed2d5e24c682eb3ae194bca4"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="auth_8h.html#fc10b497322dc030b5ac5071323404e9">AUTH_AC_PIN</a>&nbsp;&nbsp;&nbsp;0x1</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Access Condition: PIN.  <a href="#fc10b497322dc030b5ac5071323404e9"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="auth_8h.html#db433f11e23690ebc205ad9b03da9a74">AUTH_AC_ADM</a>&nbsp;&nbsp;&nbsp;0x2</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Access Condition: Key.  <a href="#db433f11e23690ebc205ad9b03da9a74"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="auth_8h.html#3272751b0b790ce197a9c07e3b5d2d2f">AUTH_AC_POA</a>&nbsp;&nbsp;&nbsp;0x3</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Access Condition: PIN or Key.  <a href="#3272751b0b790ce197a9c07e3b5d2d2f"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="auth_8h.html#f7bd31be6d42c810ad1468f5442b5de5">AUTH_AC_PAA</a>&nbsp;&nbsp;&nbsp;0x4</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Access Condition: PIN and Key.  <a href="#f7bd31be6d42c810ad1468f5442b5de5"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="auth_8h.html#af38cf2754820c9bbcbc5957fe7e509e">AUTH_AC_NEV</a>&nbsp;&nbsp;&nbsp;0xF</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Access Condition: Never.  <a href="#af38cf2754820c9bbcbc5957fe7e509e"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="auth_8h.html#9d8b6ae7a1c5ef072de2ad65e09d83d0">PIN_MAX_RETRIES</a>&nbsp;&nbsp;&nbsp;3</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Default max. retries for PIN.  <a href="#9d8b6ae7a1c5ef072de2ad65e09d83d0"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="auth_8h.html#c9ce57082eb69177a95b5f63576cb2a1">PUK_MAX_RETRIES</a>&nbsp;&nbsp;&nbsp;10</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Default max. retries for PUK.  <a href="#c9ce57082eb69177a95b5f63576cb2a1"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="auth_8h.html#aac17c4b13fe3e78f5f1a24e91028c77">PIN_TYPE_PIN</a>&nbsp;&nbsp;&nbsp;0</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">PIN type: PIN.  <a href="#aac17c4b13fe3e78f5f1a24e91028c77"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="auth_8h.html#793126c282da300f00f6a8ce2186fc53">PIN_TYPE_PUK</a>&nbsp;&nbsp;&nbsp;1</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">PIN type: PUK.  <a href="#793126c282da300f00f6a8ce2186fc53"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="auth_8h.html#6a0731f5c1b41bc071daa21d4c8fa6f7">PIN_TYPE_EXT</a>&nbsp;&nbsp;&nbsp;2</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">PIN type: Key for external authentication.  <a href="#6a0731f5c1b41bc071daa21d4c8fa6f7"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="auth_8h.html#6bd15adfa11f15032db1be399133900d">PIN_TYPE_INT</a>&nbsp;&nbsp;&nbsp;3</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">PIN type: Key for internal authentication.  <a href="#6bd15adfa11f15032db1be399133900d"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="auth_8h.html#e20960801ae4dbb25ee1ee1144bf254f">KEY_MAX_RETRIES</a>&nbsp;&nbsp;&nbsp;10</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Default max. retries for keys.  <a href="#e20960801ae4dbb25ee1ee1144bf254f"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="auth_8h.html#541eaea66766d1a05996828684dcb8db">AUTH_FID_EXTAUTH</a>&nbsp;&nbsp;&nbsp;0xFF00</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">FID for file with external authentication key.  <a href="#541eaea66766d1a05996828684dcb8db"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="auth_8h.html#3a7070ba17e95804b8d5b2ba35b3dfd3">AUTH_FID_INTAUTH</a>&nbsp;&nbsp;&nbsp;0xFF01</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">FID for file with internal authentication key.  <a href="#3a7070ba17e95804b8d5b2ba35b3dfd3"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="auth_8h.html#e7b41b442d484fa239a006c8b9a5f93c">AUTH_FID_PINPUK</a>&nbsp;&nbsp;&nbsp;0xFF02</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">FID for file with PIN and PUK.  <a href="#e7b41b442d484fa239a006c8b9a5f93c"></a><br></td></tr>
<tr><td colspan="2"><br><h2>Functions</h2></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="el" href="types_8h.html#97a80ca1602ebf2303258971a2c938e2">bool</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="auth_8h.html#98aca8fb3854ee1499ce6540ae5b893f">auth_init</a> (void)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Initialize authentication variables.  <a href="#98aca8fb3854ee1499ce6540ae5b893f"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="el" href="types_8h.html#97a80ca1602ebf2303258971a2c938e2">bool</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="auth_8h.html#c9b9b2622243783169e7ae66af6f0ae0">auth_checkAc</a> (<a class="el" href="types_8h.html#95a7dea5cbac1a117a50dccc69944d6e">iu8</a> ac)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Check fullfillment of access condition.  <a href="#c9b9b2622243783169e7ae66af6f0ae0"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="el" href="types_8h.html#97a80ca1602ebf2303258971a2c938e2">bool</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="auth_8h.html#57b022e6fdb6bbdd9c479d3a6b9fb6c0">auth_getCheckPinLen</a> (<a class="el" href="types_8h.html#95a7dea5cbac1a117a50dccc69944d6e">iu8</a> pintype, <a class="el" href="types_8h.html#95a7dea5cbac1a117a50dccc69944d6e">iu8</a> pinlen, <a class="el" href="types_8h.html#f78b002cffb8a135ab10841bc49e3e14">iu16</a> *addr, <a class="el" href="types_8h.html#95a7dea5cbac1a117a50dccc69944d6e">iu8</a> *len, <a class="el" href="types_8h.html#f78b002cffb8a135ab10841bc49e3e14">iu16</a> *rcaddr, <a class="el" href="types_8h.html#95a7dea5cbac1a117a50dccc69944d6e">iu8</a> *maxret)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Verifies length of PIN and returns addresses of PIN in EEPROM.  <a href="#57b022e6fdb6bbdd9c479d3a6b9fb6c0"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="el" href="types_8h.html#97a80ca1602ebf2303258971a2c938e2">bool</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="auth_8h.html#f345ee6ff731358a899c18c49bb43505">auth_setPin</a> (<a class="el" href="types_8h.html#95a7dea5cbac1a117a50dccc69944d6e">iu8</a> pintype, <a class="el" href="types_8h.html#95a7dea5cbac1a117a50dccc69944d6e">iu8</a> *pin, <a class="el" href="types_8h.html#95a7dea5cbac1a117a50dccc69944d6e">iu8</a> pinlen)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Write PIN, PUK, External Authentication key or Internal Authentication key.  <a href="#f345ee6ff731358a899c18c49bb43505"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="el" href="types_8h.html#97a80ca1602ebf2303258971a2c938e2">bool</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="auth_8h.html#cc47f8e744b936363d64dc20e818ac09">auth_verifyPin</a> (<a class="el" href="types_8h.html#95a7dea5cbac1a117a50dccc69944d6e">iu8</a> pintype, <a class="el" href="types_8h.html#95a7dea5cbac1a117a50dccc69944d6e">iu8</a> *pin, <a class="el" href="types_8h.html#95a7dea5cbac1a117a50dccc69944d6e">iu8</a> pinlen)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Verifies PIN, PUK or External Authentication key and sets flags in authstate.  <a href="#cc47f8e744b936363d64dc20e818ac09"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="el" href="types_8h.html#97a80ca1602ebf2303258971a2c938e2">bool</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="auth_8h.html#946f4f893b73a4170f27f9c8a181e9bb">auth_getChallenge</a> (<a class="el" href="types_8h.html#95a7dea5cbac1a117a50dccc69944d6e">iu8</a> *dst, <a class="el" href="types_8h.html#95a7dea5cbac1a117a50dccc69944d6e">iu8</a> rndlen)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Returns 8 byte challenge for External Authentication.  <a href="#946f4f893b73a4170f27f9c8a181e9bb"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="el" href="types_8h.html#97a80ca1602ebf2303258971a2c938e2">bool</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="auth_8h.html#317f35613a5f25da955d5ec69a8671c7">auth_createVerifyCryptogram</a> (<a class="el" href="types_8h.html#95a7dea5cbac1a117a50dccc69944d6e">iu8</a> *cry, <a class="el" href="types_8h.html#95a7dea5cbac1a117a50dccc69944d6e">iu8</a> crylen, <a class="el" href="types_8h.html#97a80ca1602ebf2303258971a2c938e2">bool</a> create, <a class="el" href="types_8h.html#97a80ca1602ebf2303258971a2c938e2">bool</a> enc)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Encrypt or decrypt challenge or verify cryptogram.  <a href="#317f35613a5f25da955d5ec69a8671c7"></a><br></td></tr>
<tr><td colspan="2"><br><h2>Variables</h2></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="el" href="types_8h.html#95a7dea5cbac1a117a50dccc69944d6e">iu8</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="auth_8h.html#dd47c1a71dba136bb77c433df3b0914b">challvalidity</a></td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Validity of challenge.  <a href="#dd47c1a71dba136bb77c433df3b0914b"></a><br></td></tr>
</table>
<hr><a name="_details"></a><h2>Detailed Description</h2>
Authentication declarations. 
<p>
Here are the declarations and definitions for the authentication functions. The authentication types supported are:<p>
<ul>
<li>
PIN/PUK </li>
<li>
External Authentication </li>
<li>
Internal Authentication </li>
</ul>
<p>
<dl compact><dt><b><a class="el" href="todo.html#_todo000001">Todo:</a></b></dt><dd>Here are certainly some optimizations possible to reduce code size.</dd></dl>
<dl compact><dt><b>Id</b></dt><dd><a class="el" href="auth_8h.html">auth.h</a>,v 1.11 2002/12/22 15:42:55 m Exp </dd></dl>
<hr><h2>Define Documentation</h2>
<a class="anchor" name="db433f11e23690ebc205ad9b03da9a74"></a><!-- doxytag: member="auth.h::AUTH_AC_ADM" ref="db433f11e23690ebc205ad9b03da9a74" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define AUTH_AC_ADM&nbsp;&nbsp;&nbsp;0x2          </td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Access Condition: Key. 
<p>

</div>
</div><p>
<a class="anchor" name="06f918f6ed2d5e24c682eb3ae194bca4"></a><!-- doxytag: member="auth.h::AUTH_AC_ALW" ref="06f918f6ed2d5e24c682eb3ae194bca4" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define AUTH_AC_ALW&nbsp;&nbsp;&nbsp;0x0          </td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Access Condition: Always. 
<p>

</div>
</div><p>
<a class="anchor" name="af38cf2754820c9bbcbc5957fe7e509e"></a><!-- doxytag: member="auth.h::AUTH_AC_NEV" ref="af38cf2754820c9bbcbc5957fe7e509e" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define AUTH_AC_NEV&nbsp;&nbsp;&nbsp;0xF          </td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Access Condition: Never. 
<p>

</div>
</div><p>
<a class="anchor" name="f7bd31be6d42c810ad1468f5442b5de5"></a><!-- doxytag: member="auth.h::AUTH_AC_PAA" ref="f7bd31be6d42c810ad1468f5442b5de5" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define AUTH_AC_PAA&nbsp;&nbsp;&nbsp;0x4          </td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Access Condition: PIN and Key. 
<p>

</div>
</div><p>
<a class="anchor" name="fc10b497322dc030b5ac5071323404e9"></a><!-- doxytag: member="auth.h::AUTH_AC_PIN" ref="fc10b497322dc030b5ac5071323404e9" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define AUTH_AC_PIN&nbsp;&nbsp;&nbsp;0x1          </td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Access Condition: PIN. 
<p>

</div>
</div><p>
<a class="anchor" name="3272751b0b790ce197a9c07e3b5d2d2f"></a><!-- doxytag: member="auth.h::AUTH_AC_POA" ref="3272751b0b790ce197a9c07e3b5d2d2f" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define AUTH_AC_POA&nbsp;&nbsp;&nbsp;0x3          </td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Access Condition: PIN or Key. 
<p>

</div>
</div><p>
<a class="anchor" name="541eaea66766d1a05996828684dcb8db"></a><!-- doxytag: member="auth.h::AUTH_FID_EXTAUTH" ref="541eaea66766d1a05996828684dcb8db" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define AUTH_FID_EXTAUTH&nbsp;&nbsp;&nbsp;0xFF00          </td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
FID for file with external authentication key. 
<p>
It is only searched for the file in the MF and not in any DF. 
</div>
</div><p>
<a class="anchor" name="3a7070ba17e95804b8d5b2ba35b3dfd3"></a><!-- doxytag: member="auth.h::AUTH_FID_INTAUTH" ref="3a7070ba17e95804b8d5b2ba35b3dfd3" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define AUTH_FID_INTAUTH&nbsp;&nbsp;&nbsp;0xFF01          </td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
FID for file with internal authentication key. 
<p>
It is only searched for the file in the MF and not in any DF. 
</div>
</div><p>
<a class="anchor" name="e7b41b442d484fa239a006c8b9a5f93c"></a><!-- doxytag: member="auth.h::AUTH_FID_PINPUK" ref="e7b41b442d484fa239a006c8b9a5f93c" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define AUTH_FID_PINPUK&nbsp;&nbsp;&nbsp;0xFF02          </td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
FID for file with PIN and PUK. 
<p>
It is only searched for the file in the MF and not in any DF. 
</div>
</div><p>
<a class="anchor" name="1defcbb7e6fa25bac6924c00f4614d35"></a><!-- doxytag: member="auth.h::AUTH_FLAG_KEY" ref="1defcbb7e6fa25bac6924c00f4614d35" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define AUTH_FLAG_KEY&nbsp;&nbsp;&nbsp;0x02          </td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Flag for authstate signalling a successful external authentication or key verification. 
<p>

</div>
</div><p>
<a class="anchor" name="eaa1f3d53530fd751bea7f48a6ee7cc6"></a><!-- doxytag: member="auth.h::AUTH_FLAG_PIN" ref="eaa1f3d53530fd751bea7f48a6ee7cc6" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define AUTH_FLAG_PIN&nbsp;&nbsp;&nbsp;0x01          </td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Flag for authstate signalling a successful PIN verification. 
<p>

</div>
</div><p>
<a class="anchor" name="e20960801ae4dbb25ee1ee1144bf254f"></a><!-- doxytag: member="auth.h::KEY_MAX_RETRIES" ref="e20960801ae4dbb25ee1ee1144bf254f" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define KEY_MAX_RETRIES&nbsp;&nbsp;&nbsp;10          </td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Default max. retries for keys. 
<p>

</div>
</div><p>
<a class="anchor" name="9d8b6ae7a1c5ef072de2ad65e09d83d0"></a><!-- doxytag: member="auth.h::PIN_MAX_RETRIES" ref="9d8b6ae7a1c5ef072de2ad65e09d83d0" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define PIN_MAX_RETRIES&nbsp;&nbsp;&nbsp;3          </td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Default max. retries for PIN. 
<p>

</div>
</div><p>
<a class="anchor" name="6a0731f5c1b41bc071daa21d4c8fa6f7"></a><!-- doxytag: member="auth.h::PIN_TYPE_EXT" ref="6a0731f5c1b41bc071daa21d4c8fa6f7" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define PIN_TYPE_EXT&nbsp;&nbsp;&nbsp;2          </td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
PIN type: Key for external authentication. 
<p>

</div>
</div><p>
<a class="anchor" name="6bd15adfa11f15032db1be399133900d"></a><!-- doxytag: member="auth.h::PIN_TYPE_INT" ref="6bd15adfa11f15032db1be399133900d" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define PIN_TYPE_INT&nbsp;&nbsp;&nbsp;3          </td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
PIN type: Key for internal authentication. 
<p>

</div>
</div><p>
<a class="anchor" name="aac17c4b13fe3e78f5f1a24e91028c77"></a><!-- doxytag: member="auth.h::PIN_TYPE_PIN" ref="aac17c4b13fe3e78f5f1a24e91028c77" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define PIN_TYPE_PIN&nbsp;&nbsp;&nbsp;0          </td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
PIN type: PIN. 
<p>

</div>
</div><p>
<a class="anchor" name="793126c282da300f00f6a8ce2186fc53"></a><!-- doxytag: member="auth.h::PIN_TYPE_PUK" ref="793126c282da300f00f6a8ce2186fc53" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define PIN_TYPE_PUK&nbsp;&nbsp;&nbsp;1          </td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
PIN type: PUK. 
<p>

</div>
</div><p>
<a class="anchor" name="c9ce57082eb69177a95b5f63576cb2a1"></a><!-- doxytag: member="auth.h::PUK_MAX_RETRIES" ref="c9ce57082eb69177a95b5f63576cb2a1" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define PUK_MAX_RETRIES&nbsp;&nbsp;&nbsp;10          </td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Default max. retries for PUK. 
<p>

</div>
</div><p>
<hr><h2>Function Documentation</h2>
<a class="anchor" name="c9b9b2622243783169e7ae66af6f0ae0"></a><!-- doxytag: member="auth.h::auth_checkAc" ref="c9b9b2622243783169e7ae66af6f0ae0" args="(iu8 ac)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="types_8h.html#97a80ca1602ebf2303258971a2c938e2">bool</a> auth_checkAc           </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="types_8h.html#95a7dea5cbac1a117a50dccc69944d6e">iu8</a>&nbsp;</td>
          <td class="paramname"> <em>ac</em>          </td>
          <td>&nbsp;)&nbsp;</td>
          <td width="100%"></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Check fullfillment of access condition. 
<p>
This function checks, if the current setting of authstate fullfills the condition specified with <em>ac</em>.<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>ac</em>&nbsp;</td><td>A nibble specifying an access condition.</td></tr>
  </table>
</dl>
<dl compact><dt><b>Return values:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>TRUE</em>&nbsp;</td><td>on success. </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>FALSE</em>&nbsp;</td><td>on failure. Error code given in sw. </td></tr>
  </table>
</dl>

</div>
</div><p>
<a class="anchor" name="317f35613a5f25da955d5ec69a8671c7"></a><!-- doxytag: member="auth.h::auth_createVerifyCryptogram" ref="317f35613a5f25da955d5ec69a8671c7" args="(iu8 *cry, iu8 crylen, bool create, bool enc)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="types_8h.html#97a80ca1602ebf2303258971a2c938e2">bool</a> auth_createVerifyCryptogram           </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="types_8h.html#95a7dea5cbac1a117a50dccc69944d6e">iu8</a> *&nbsp;</td>
          <td class="paramname"> <em>cry</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="types_8h.html#95a7dea5cbac1a117a50dccc69944d6e">iu8</a>&nbsp;</td>
          <td class="paramname"> <em>crylen</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="types_8h.html#97a80ca1602ebf2303258971a2c938e2">bool</a>&nbsp;</td>
          <td class="paramname"> <em>create</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="types_8h.html#97a80ca1602ebf2303258971a2c938e2">bool</a>&nbsp;</td>
          <td class="paramname"> <em>enc</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td width="100%"></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Encrypt or decrypt challenge or verify cryptogram. 
<p>
To include the decryption process CONF_WITH_DECRYPT must be set to 1.<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>cry</em>&nbsp;</td><td>Pointer to byte array, which supplies challenge and which is used to return the encrypted or decrypted challenge or a cryptogram. </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>crylen</em>&nbsp;</td><td>Length of challenge or cryptogram. </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>create</em>&nbsp;</td><td>If set to TRUE, a challenge is processed, else a cryptogram is verified. </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>enc</em>&nbsp;</td><td>If CONF_WITH_DECRYPT is not set to 1, this has no effect. Otherwise, if TRUE encrypt the challenge, else decrypt it. If <em>create</em> is FALSE, this parameter is ignored.</td></tr>
  </table>
</dl>
<dl compact><dt><b>Return values:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>TRUE</em>&nbsp;</td><td>on success. </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>FALSE</em>&nbsp;</td><td>on failure. Error code given in sw. </td></tr>
  </table>
</dl>

</div>
</div><p>
<a class="anchor" name="946f4f893b73a4170f27f9c8a181e9bb"></a><!-- doxytag: member="auth.h::auth_getChallenge" ref="946f4f893b73a4170f27f9c8a181e9bb" args="(iu8 *dst, iu8 rndlen)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="types_8h.html#97a80ca1602ebf2303258971a2c938e2">bool</a> auth_getChallenge           </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="types_8h.html#95a7dea5cbac1a117a50dccc69944d6e">iu8</a> *&nbsp;</td>
          <td class="paramname"> <em>dst</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="types_8h.html#95a7dea5cbac1a117a50dccc69944d6e">iu8</a>&nbsp;</td>
          <td class="paramname"> <em>rndlen</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td width="100%"></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Returns 8 byte challenge for External Authentication. 
<p>
The challenge is also written to the challenge array and challvalidity is set to 2.<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>dst</em>&nbsp;</td><td>Destination byte array. </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>rndlen</em>&nbsp;</td><td>Length of requested data. This must be 8.</td></tr>
  </table>
</dl>
<dl compact><dt><b>Return values:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>TRUE</em>&nbsp;</td><td>on success. </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>FALSE</em>&nbsp;</td><td>on failure. Error code given in sw. </td></tr>
  </table>
</dl>

</div>
</div><p>
<a class="anchor" name="57b022e6fdb6bbdd9c479d3a6b9fb6c0"></a><!-- doxytag: member="auth.h::auth_getCheckPinLen" ref="57b022e6fdb6bbdd9c479d3a6b9fb6c0" args="(iu8 pintype, iu8 pinlen, iu16 *addr, iu8 *len, iu16 *rcaddr, iu8 *maxret)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="types_8h.html#97a80ca1602ebf2303258971a2c938e2">bool</a> auth_getCheckPinLen           </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="types_8h.html#95a7dea5cbac1a117a50dccc69944d6e">iu8</a>&nbsp;</td>
          <td class="paramname"> <em>pintype</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="types_8h.html#95a7dea5cbac1a117a50dccc69944d6e">iu8</a>&nbsp;</td>
          <td class="paramname"> <em>pinlen</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="types_8h.html#f78b002cffb8a135ab10841bc49e3e14">iu16</a> *&nbsp;</td>
          <td class="paramname"> <em>addr</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="types_8h.html#95a7dea5cbac1a117a50dccc69944d6e">iu8</a> *&nbsp;</td>
          <td class="paramname"> <em>len</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="types_8h.html#f78b002cffb8a135ab10841bc49e3e14">iu16</a> *&nbsp;</td>
          <td class="paramname"> <em>rcaddr</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="types_8h.html#95a7dea5cbac1a117a50dccc69944d6e">iu8</a> *&nbsp;</td>
          <td class="paramname"> <em>maxret</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td width="100%"></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Verifies length of PIN and returns addresses of PIN in EEPROM. 
<p>
This functions does depending on <em>pintype</em>:<p>
<ul>
<li>
Check the length of the PIN or key. </li>
<li>
Return the address of the PIN or key in EEPROM. </li>
<li>
Return the length of the PIN or key in EEPROM. </li>
<li>
Return the address of the retry counter in EEPROM. </li>
<li>
Return the default max. value for the retry counter. </li>
</ul>
<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>pintype</em>&nbsp;</td><td>PIN type. One of the PIN_TYPE defines. </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>pinlen</em>&nbsp;</td><td>Length of supplied PIN or key. </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>addr</em>&nbsp;</td><td>Returns the address of the PIN or key in EEPROM. </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>len</em>&nbsp;</td><td>Returns the length ofthe PIN or key in EEPROM. </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>rcaddr</em>&nbsp;</td><td>Returns the address of the retry counter for the PIN or key. </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>maxret</em>&nbsp;</td><td>Returns the default max. value for the retry counter.</td></tr>
  </table>
</dl>
<dl compact><dt><b>Return values:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>TRUE</em>&nbsp;</td><td>on success. </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>FALSE</em>&nbsp;</td><td>on failure. Error code given in sw. </td></tr>
  </table>
</dl>

</div>
</div><p>
<a class="anchor" name="98aca8fb3854ee1499ce6540ae5b893f"></a><!-- doxytag: member="auth.h::auth_init" ref="98aca8fb3854ee1499ce6540ae5b893f" args="(void)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="types_8h.html#97a80ca1602ebf2303258971a2c938e2">bool</a> auth_init           </td>
          <td>(</td>
          <td class="paramtype">void&nbsp;</td>
          <td class="paramname">          </td>
          <td>&nbsp;)&nbsp;</td>
          <td width="100%"></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Initialize authentication variables. 
<p>
This function resets authstate and challvalidity. It must be called after reset.<p>
<dl compact><dt><b>Return values:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>TRUE</em>&nbsp;</td><td>on success. </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>FALSE</em>&nbsp;</td><td>on failure. Error code given in sw. </td></tr>
  </table>
</dl>

</div>
</div><p>
<a class="anchor" name="f345ee6ff731358a899c18c49bb43505"></a><!-- doxytag: member="auth.h::auth_setPin" ref="f345ee6ff731358a899c18c49bb43505" args="(iu8 pintype, iu8 *pin, iu8 pinlen)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="types_8h.html#97a80ca1602ebf2303258971a2c938e2">bool</a> auth_setPin           </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="types_8h.html#95a7dea5cbac1a117a50dccc69944d6e">iu8</a>&nbsp;</td>
          <td class="paramname"> <em>pintype</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="types_8h.html#95a7dea5cbac1a117a50dccc69944d6e">iu8</a> *&nbsp;</td>
          <td class="paramname"> <em>pin</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="types_8h.html#95a7dea5cbac1a117a50dccc69944d6e">iu8</a>&nbsp;</td>
          <td class="paramname"> <em>pinlen</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td width="100%"></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Write PIN, PUK, External Authentication key or Internal Authentication key. 
<p>
The process is secured by transactions.<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>pintype</em>&nbsp;</td><td>Type of the PIN/Key. May be one of the PIN_TYPE_* defines. </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>pin</em>&nbsp;</td><td>Pointer to byte array containing PIN/Key. </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>pinlen</em>&nbsp;</td><td>Length of PIN/Key.</td></tr>
  </table>
</dl>
<dl compact><dt><b>Return values:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>TRUE</em>&nbsp;</td><td>on success. </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>FALSE</em>&nbsp;</td><td>on failure. Error code given in sw. </td></tr>
  </table>
</dl>

</div>
</div><p>
<a class="anchor" name="cc47f8e744b936363d64dc20e818ac09"></a><!-- doxytag: member="auth.h::auth_verifyPin" ref="cc47f8e744b936363d64dc20e818ac09" args="(iu8 pintype, iu8 *pin, iu8 pinlen)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="types_8h.html#97a80ca1602ebf2303258971a2c938e2">bool</a> auth_verifyPin           </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="types_8h.html#95a7dea5cbac1a117a50dccc69944d6e">iu8</a>&nbsp;</td>
          <td class="paramname"> <em>pintype</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="types_8h.html#95a7dea5cbac1a117a50dccc69944d6e">iu8</a> *&nbsp;</td>
          <td class="paramname"> <em>pin</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="types_8h.html#95a7dea5cbac1a117a50dccc69944d6e">iu8</a>&nbsp;</td>
          <td class="paramname"> <em>pinlen</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td width="100%"></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Verifies PIN, PUK or External Authentication key and sets flags in authstate. 
<p>
The update of the retry counter is secured by transactions.<p>
<em>Warning: Currently the retry counter is not handled in a secure way. For more information see e.g. Rankl/Effing.</em><p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>pintype</em>&nbsp;</td><td>Type of the PIN/Key. May be one of the PIN_TYPE_* defines. </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>pin</em>&nbsp;</td><td>Pointer to byte array containing PIN/Key. </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>pinlen</em>&nbsp;</td><td>Length of PIN/Key.</td></tr>
  </table>
</dl>
<dl compact><dt><b>Return values:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>TRUE</em>&nbsp;</td><td>on success. </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>FALSE</em>&nbsp;</td><td>on failure. Error code given in sw. </td></tr>
  </table>
</dl>

</div>
</div><p>
<hr><h2>Variable Documentation</h2>
<a class="anchor" name="dd47c1a71dba136bb77c433df3b0914b"></a><!-- doxytag: member="auth.h::challvalidity" ref="dd47c1a71dba136bb77c433df3b0914b" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="types_8h.html#95a7dea5cbac1a117a50dccc69944d6e">iu8</a> <a class="el" href="authtest_8c.html#dd47c1a71dba136bb77c433df3b0914b">challvalidity</a>          </td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Validity of challenge. 
<p>
The initial value if challvalidity is 2. This is decremented at the start of the command loop, so that it is 1 at the command following a Get Challenge. 
</div>
</div><p>
<hr><address><small>
Copyright 2002 by Matthias Bruestle. This is licensed under the GNU
General Public License.
</small></address>
</body>
</html>
