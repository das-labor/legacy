<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>SOSSE: transaction.h File Reference</title>
<link href="sos.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.4.7 -->
<div class="tabs">
  <ul>
    <li><a href="index.html"><span>Main&nbsp;Page</span></a></li>
    <li><a href="annotated.html"><span>Data&nbsp;Structures</span></a></li>
    <li id="current"><a href="files.html"><span>Files</span></a></li>
    <li><a href="pages.html"><span>Related&nbsp;Pages</span></a></li>
  </ul></div>
<div class="tabs">
  <ul>
    <li><a href="files.html"><span>File&nbsp;List</span></a></li>
    <li><a href="globals.html"><span>Globals</span></a></li>
  </ul></div>
<h1>transaction.h File Reference</h1>Transaction declarations. <a href="#_details">More...</a>
<p>
<code>#include &lt;<a class="el" href="types_8h-source.html">types.h</a>&gt;</code><br>

<p>
<a href="transaction_8h-source.html">Go to the source code of this file.</a><table border="0" cellpadding="0" cellspacing="0">
<tr><td></td></tr>
<tr><td colspan="2"><br><h2>Defines</h2></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="transaction_8h.html#ca24633392a9ecbc750ce1202abd45f0">TRANSAC_STATE_CLEAN</a>&nbsp;&nbsp;&nbsp;0x00</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="transaction_8h.html#03d3caf4f4e69fb09b746c5d1053357e">TRANSAC_STATE_DATA</a>&nbsp;&nbsp;&nbsp;0xA5</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Transaction buffer contains data.  <a href="#03d3caf4f4e69fb09b746c5d1053357e"></a><br></td></tr>
<tr><td colspan="2"><br><h2>Functions</h2></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="el" href="types_8h.html#97a80ca1602ebf2303258971a2c938e2">bool</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="transaction_8h.html#e0ead4e9d2dc0e305973f13324a356aa">ta_setdata</a> (<a class="el" href="types_8h.html#95a7dea5cbac1a117a50dccc69944d6e">iu8</a> *data, <a class="el" href="types_8h.html#95a7dea5cbac1a117a50dccc69944d6e">iu8</a> len, <a class="el" href="types_8h.html#f78b002cffb8a135ab10841bc49e3e14">iu16</a> dst)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Begins a transaction and sets the data.  <a href="#e0ead4e9d2dc0e305973f13324a356aa"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="el" href="types_8h.html#97a80ca1602ebf2303258971a2c938e2">bool</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="transaction_8h.html#cacd724418635980cbe9ff7caab01e9c">ta_commit</a> (void)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Commits the data in the transaction buffer.  <a href="#cacd724418635980cbe9ff7caab01e9c"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="el" href="types_8h.html#97a80ca1602ebf2303258971a2c938e2">bool</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="transaction_8h.html#a7051804d3c2320a9510087b4bf945c2">ta_rollback</a> (void)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Do a rollback and discard the data in the transaction buffer.  <a href="#a7051804d3c2320a9510087b4bf945c2"></a><br></td></tr>
</table>
<hr><a name="_details"></a><h2>Detailed Description</h2>
Transaction declarations. 
<p>
<dl compact><dt><b>Note:</b></dt><dd>Is the current transaction implementation secure against tearing? IMO it should be nearly be. Let's consider following scenarios:</dd></dl>
1) Card is removed while writing the data for the transaction: This is no problem, because the state is still TRANSAC_STATE_CLEAN.<p>
2) Card is removed while writing the status byte: This is most likely no problem. If the state is anything other than TRANSAC_STATE_DATA, it is regarded as clean, which it is. The only problem is, when it accidently is TRANSAC_STATE_DATA, which is IMO very unlikely, because the erased state is totally different. But on the other side, if the card tearing occured shortly after the state update, the state really is TRANSAC_STATE_DATA.<p>
3) Card is removed while doing a commit and writing the data therein: This is no problem, because after the next reset the commit is tried again.<p>
4) Card is removed after a commit, while reseting the status byte: This is no problem, because most likely the new state is interpreted as TRANSAC_STATE_CLEAN, which it is, and if the new state is really TRANSAC_STATE_DATA, it is just a second time written.<p>
5) Card is removed while writing status byte in a rollback: This might be a problem, because the rollback might file, when the unlikely event occures, that the state is TRANSAC_STATE_DATA. But this can also happen, if the card is removed before the rollback, because the state is there already TRANSAC_STATE_DATA.<p>
<dl compact><dt><b>Id</b></dt><dd><a class="el" href="transaction_8h.html">transaction.h</a>,v 1.9 2002/12/22 15:42:56 m Exp </dd></dl>
<hr><h2>Define Documentation</h2>
<a class="anchor" name="ca24633392a9ecbc750ce1202abd45f0"></a><!-- doxytag: member="transaction.h::TRANSAC_STATE_CLEAN" ref="ca24633392a9ecbc750ce1202abd45f0" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define TRANSAC_STATE_CLEAN&nbsp;&nbsp;&nbsp;0x00          </td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Transaction buffer is clean. (Also all other values not being 0xA5 are interpreted as clean. 
</div>
</div><p>
<a class="anchor" name="03d3caf4f4e69fb09b746c5d1053357e"></a><!-- doxytag: member="transaction.h::TRANSAC_STATE_DATA" ref="03d3caf4f4e69fb09b746c5d1053357e" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define TRANSAC_STATE_DATA&nbsp;&nbsp;&nbsp;0xA5          </td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Transaction buffer contains data. 
<p>

</div>
</div><p>
<hr><h2>Function Documentation</h2>
<a class="anchor" name="cacd724418635980cbe9ff7caab01e9c"></a><!-- doxytag: member="transaction.h::ta_commit" ref="cacd724418635980cbe9ff7caab01e9c" args="(void)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="types_8h.html#97a80ca1602ebf2303258971a2c938e2">bool</a> ta_commit           </td>
          <td>(</td>
          <td class="paramtype">void&nbsp;</td>
          <td class="paramname">          </td>
          <td>&nbsp;)&nbsp;</td>
          <td width="100%"></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Commits the data in the transaction buffer. 
<p>
Data is written to the destination specified in <a class="el" href="transaction_8c.html#e0ead4e9d2dc0e305973f13324a356aa">ta_setdata()</a>. The state is then set to clean.<p>
This function must be called after each reset to commit pending transactions.<p>
<dl compact><dt><b>Return values:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>TRUE</em>&nbsp;</td><td>on success. </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>FALSE</em>&nbsp;</td><td>on failure. Error code given in sw. </td></tr>
  </table>
</dl>

</div>
</div><p>
<a class="anchor" name="a7051804d3c2320a9510087b4bf945c2"></a><!-- doxytag: member="transaction.h::ta_rollback" ref="a7051804d3c2320a9510087b4bf945c2" args="(void)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="types_8h.html#97a80ca1602ebf2303258971a2c938e2">bool</a> ta_rollback           </td>
          <td>(</td>
          <td class="paramtype">void&nbsp;</td>
          <td class="paramname">          </td>
          <td>&nbsp;)&nbsp;</td>
          <td width="100%"></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Do a rollback and discard the data in the transaction buffer. 
<p>
The state is set to clean.<p>
<dl compact><dt><b>Return values:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>TRUE</em>&nbsp;</td><td>on success. </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>FALSE</em>&nbsp;</td><td>on failure. Error code given in sw. </td></tr>
  </table>
</dl>

</div>
</div><p>
<a class="anchor" name="e0ead4e9d2dc0e305973f13324a356aa"></a><!-- doxytag: member="transaction.h::ta_setdata" ref="e0ead4e9d2dc0e305973f13324a356aa" args="(iu8 *data, iu8 len, iu16 dst)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="types_8h.html#97a80ca1602ebf2303258971a2c938e2">bool</a> ta_setdata           </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="types_8h.html#95a7dea5cbac1a117a50dccc69944d6e">iu8</a> *&nbsp;</td>
          <td class="paramname"> <em>data</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="types_8h.html#95a7dea5cbac1a117a50dccc69944d6e">iu8</a>&nbsp;</td>
          <td class="paramname"> <em>len</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="types_8h.html#f78b002cffb8a135ab10841bc49e3e14">iu16</a>&nbsp;</td>
          <td class="paramname"> <em>dst</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td width="100%"></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Begins a transaction and sets the data. 
<p>
<em>data/len</em> bytes are written to the transaction buffer. The destination address is also stored there. Then the state is set to TRANSAC_STATE_DATA.<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>data</em>&nbsp;</td><td>Pointer to the data to write into the transaction buffer. </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>len</em>&nbsp;</td><td>Length of the data. (Max.: TRANSAC_DATA_LEN) </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>dst</em>&nbsp;</td><td>Destination of the data in EEPROM.</td></tr>
  </table>
</dl>
<dl compact><dt><b>Return values:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>TRUE</em>&nbsp;</td><td>on success. </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>FALSE</em>&nbsp;</td><td>on failure. Error code given in sw. </td></tr>
  </table>
</dl>

</div>
</div><p>
<hr><address><small>
Copyright 2002 by Matthias Bruestle. This is licensed under the GNU
General Public License.
</small></address>
</body>
</html>
